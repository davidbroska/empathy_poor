---
title: "Report for MTurk Pilot (n=216)"
subtitle: "2022_08_02_Empathy_Poor_Homelessness"
author: "David Broska"
date: "`r Sys.Date()`"
output: 
  bookdown::pdf_document2:
toc: true
geometry: "left=2cm, right=2cm, top=1.5cm, bottom=1.75cm"  
---

\newpage

\listoffigures

\listoftables

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = F, out.width = "85%", fig.pos = 'H', fig.align = "center")
options(dplyr.summarise.inform = FALSE)
library(dplyr)
library(ggplot2)
library(ggtext)
library(stringr)
library(ggpubr)
library(readr)
library(kableExtra)
library(broom)
library(lubridate)

theme_set(theme_bw())
col_names <- names(read_csv("3_n200_pilot/mturk_pilot_10_14_2022.csv",n_max =  0))
# drop first two lines that describe the data in the columns
df_raw123 <- read_csv("3_n200_pilot/mturk_pilot_10_14_2022.csv", col_names = col_names, skip = 3) %>% 
  filter(Status != "Survey Preview") %>% 
  mutate(start_ymd = as.Date(StartDate), 
         pilot_number = case_when(start_ymd==as.Date("2022-10-06") ~ "1_n15",
                                  start_ymd==as.Date("2022-10-12") ~ "2_n15", 
                                  start_ymd %in% as.Date(c("2022-10-13", "2022-10-14"))~"3_n200"))

question_text <- as.character(read_csv("3_n200_pilot/mturk_pilot_10_14_2022.csv")[1,])

```


\newpage 

# Completion time after cutting videos

```{r completion-time}
comp_time <- df_raw123 %>% 
  mutate(studies = ifelse(pilot_number %in% c("1_n15", "2_n15"), "old  (uncut videos)", "new (cut videos)")) %>% 
  group_by(studies) %>% 
  summarize(min =min(EndDate - StartDate), 
            median = median(EndDate - StartDate),
            avg = mean(EndDate - StartDate),
            max = max(EndDate - StartDate)) %>% 
  mutate_at(vars(min,max,avg,median), as.numeric) %>%
  mutate_if(is.numeric,  ~ paste0(floor(.), "min ", round(((.-floor(.)) * 60), 0), "s")) 
```


We conducted a $n=15$ pilot on Oct 10, a second $n=15$ pilot on Oct 12, and a full $n=201$ study on on October 13-14, 2022.

Cutting the videos reduced the median response time from `r comp_time$median[comp_time=="uncut videos"]` in first pilot to `r comp_time$median[comp_time=="cut videos"]` in the full study and the second pilot.

```{r}
kable(comp_time, col.names = c("Study", "Min", "Median", "Mean", "Max"), 
      caption = "Completion time", booktabs=T) %>% 
  kable_styling(latex_options = c("HOLD_position","striped"))
```



```{r sanity-checks}
# exclude first pilot because of different video lengths
df_raw <- df_raw123 %>% filter(pilot_number != "1_n15")

# mobility manipulation check
df_raw <- df_raw %>% 
  mutate(mob_manip_correct = case_when(
    mobility_condition=="high"& mob_manip_check=="There are good opportunities to advance through hard-work"~1,
    mobility_condition=="low"&mob_manip_check=="Opportunities to advance through hard-work are very limited"~1)) %>% 
  mutate(mob_manip_correct = ifelse(is.na(mob_manip_correct), 0, 1), 
         # attention check failed if they did not fill it out or if they did not select Cashier
         att_check_passed = if_else(!is.na(attention_check) & attention_check == "Cashier", 1, 0)) 


# attention check
check_att <- sum(df_raw$att_check_passed)
check_att_perc <- round(100 * check_att / nrow(df_raw), 2)
# mobility manipulation 
mob_manip <- sum(df_raw$mob_manip_correct)
mob_manip_perc <- round(100*mob_manip / nrow(df_raw), 2)
# empathy manipulation
pval_emp_manip1 <- t.test(emp_manip_check_3 ~ empathy_condition,df_raw)$p.value
pval_emp_manip2 <- t.test(emp_manip_check_4 ~ empathy_condition,df_raw)$p.value
pval_emp_manip3 <- t.test(emp_manip_check_5 ~ empathy_condition,df_raw)$p.value

ttest_sub_emob <- t.test(sub_effort_1 ~ mobility_condition, df_raw) 

# keep 
df <- df_raw %>% filter(mob_manip_correct == 1, att_check_passed == 1)

report_pval <- function(pval){
  ifelse(pval < 0.01, "p < 0.01", paste0("p $\\approx$ ",round(pval, 2)))
}
```



# Attention and manipulation checks

The responses from the first $n=15$ pilot were discarded because respondents saw a different version of the study, i.e. that with the longer videos. The remaining `r nrow(df_raw)` respondents completed attention and manipulation checks at an acceptable level. 

- __Attention__: `r check_att` out of `r nrow(df_raw)` (`r check_att_perc`%) respondents selected the correct answer.
- __Mobility manipulation__: `r mob_manip` out of `r nrow(df_raw)` (`r mob_manip_perc`%) respondents selected the correct answer when asked about the availability of opportunities according to the vignette. 
- __Subjective effort based mobility__: Respondents in the low mobility condition perceive mobility to be lower on average (`r round(ttest_sub_emob$estimate["mean in group low"],1)`) than those in the high mobility condition (`r round(ttest_sub_emob$estimate["mean in group high"],1)`) with $`r report_pval(ttest_sub_emob$p.value)`$.
- __Empathy manipulation__: In three survey items, respondents indicated on average more empathy towards the individuals in the homelessness videos when compared to those in the control videos with $`r report_pval(pval_emp_manip1)`$, $`r report_pval(pval_emp_manip2)`$, and $`r report_pval(pval_emp_manip3)`$ respectively.

The following analysis was conducted on `r nrow(df)` out of `r nrow(df_raw)` initial observations.

# Treatment assignment

```{r}
# number of participants assigned to conditions
df %>%
  mutate(party_id = str_remove(party_id, "[0-9]+: ") %>% factor(levels = c("Democrat","Republican","Independent"))) %>% 
  group_by(party_id, mobility_condition, empathy_condition) %>% count(name = "n_emp") %>% 
  group_by(party_id) %>% mutate(n_party = sum(n_emp)) %>% 
  group_by(mobility_condition, party_id) %>% mutate(n_mob = sum(n_emp)) %>%
  select(party_id, n_party, mobility_condition, n_mob, empathy_condition, n_emp) %>% 
  kable(col.names = linebreak(c("Party", "n", "Condition", "n", "Condition", "n")), 
        booktabs= T, escape = F, caption = paste0("Assignment of ", nrow(df), " participants to combinations of survey quota and conditions")) %>% 
  kable_styling(latex_options = "HOLD_position") %>% 
  # collapse number of party affiliations
  collapse_rows(columns = 1:4, target = 1) %>% 
  # collapse number of respondents in mobility conditions
  #collapse_rows(columns = c(4), target = 3) %>% 
  add_header_above(c(" "=2,"Mobility"=2,"Empathy"=2))
```

```{r, include=F}
dc <- tibble(condition="control", scnds = select(df, `cntrl1_time_Page Submit`, `cntrl2_time_Page Submit`) %>% na.omit() %>% rowSums(na.rm = T))
dt <- tibble(condition="treatment", scnds = select(df, `unhsd1_time_Page Submit`, `unshd2_time_Page Submit`, `unshd3_time_Page Submit`, `unhsd4_time_Page Submit`) %>% rowSums(na.rm = T)) %>% filter(scnds > 0)

bind_rows(dc,dt) %>% 
  group_by(condition) %>% 
  summarise(median_time = median(scnds), 
            avg_time = mean(scnds),
            min_time = min(scnds), 
            max_time = max(scnds)) %>% 
  mutate_if(is.numeric,  ~ paste0(floor(. / 60), "min ", round(. - 60 * floor(. / 60)), "s")) 

# video duration from youtube (little lower in qualtrics) 
old_vids <- data.frame(video = c("unhsd1", "unhsd2", "unhsd3", "unhsd4", "cntr1", "cntr2"), 
           scnds = c(258, 302, 193, 138, 135,126)) 

 

trimmed_vids <- data.frame(video = c("unhsd1", "unhsd2", "unhsd3", "unhsd4", "cntr1", "cntr2"), 
           scnds = c(144, 142, 152, 137, 135, 126)) %>% 
  mutate(min = paste0(floor(scnds / 60), "min ", round(scnds - 60 * floor(scnds / 60)), "s")) 

old_vids %>% 
  mutate(condition = ifelse(str_detect(video, "unhsd"), "treatment", "control")) %>% 
  group_by(condition) %>% 
  summarise(avg_duration = mean(scnds), min_duration = min(scnds), max_duration = max(scnds)) %>% 
  mutate_if(is.numeric,  ~ paste0(floor(. / 60), "min ", round(. - 60 * floor(. / 60)), "s")) 

trimmed_vids %>% 
  mutate(condition = ifelse(str_detect(video, "unhsd"), "treatment", "control")) %>% 
  group_by(condition) %>% 
  summarise(avg_duration = mean(scnds), min_duration = min(scnds), max_duration = max(scnds)) %>% 
  mutate_if(is.numeric,  ~ paste0(floor(. / 60), "min ", round(. - 60 * floor(. / 60)), "s")) 
  
old_vids
trimmed_vids


```

# Dependent variables

```{r}
get_qtext <- function(pattern){
  tibble(variable = col_names, question_text) %>% 
    mutate(question_text=str_remove(question_text, "[a-zA-Z ]+[: …...]+ -") %>% 
             str_replace_all("[“”]", "") %>% str_replace_all("−","-")) %>% 
    filter(variable == pattern) %>% 
    pull(question_text)
}


tibble(variable = col_names, question_text) %>% 
  mutate(question_text=str_remove(question_text, "[a-zA-Z ]+[: …...]+ -")) %>% 
  filter(grepl("dv_", variable)) %>% 
  kable(booktabs= T, col.names = c("Variable", "Question Text")) %>% 
  kable_styling(full_width = F, latex_options = c("HOLD_position", "scale_down","striped")) %>% 
  column_spec(2,width_max = "30em")
```



# Results

__Note:__ The figures report the mean in the four groups and the associated standard error of the mean (se).

__Abbreviations:__ 

- Ps: Participants
- HM: High mobility (chances of earning more than one's parents are high)
- LM: Low mobility (changes are low)
- ET: Empathy treatment (exposure to homelessness through videos)
- EC: Empathy control (exposure to neutral videos)



```{r plot-dv-function}

plot_dv <- function(dependent_var, ylab="Agreement", xlab="Empathy Condition",caption = "", subtitle=NA){
  
  d <- df[,c(dependent_var, "mobility_condition", "empathy_condition")]
  colnames(d)[1] <- "y"

  summ <- d %>% 
    group_by(empathy_condition, mobility_condition) %>%
    summarise(mean.value = mean(y),
              sd.value = sd(y), count = n(),
              se.mean = sd.value/sqrt(count)) %>% 
    ungroup()
  
  summ_m <- d %>% 
    group_by(mobility_condition) %>% 
    summarise(mean = mean(y),
              sd = sd(y), count = n(),
              se.mean = sd/sqrt(count)) %>% 
    ungroup()
  
  # high vs low mobility
  mhigh <- df[df$mobility_condition=="high",]
  mlow  <- df[df$mobility_condition=="low",]
  
  avg_mhigh <- filter(summ_m,mobility_condition=="high") %>% pull(mean) %>% round(1)
  se_mhigh <-  filter(summ_m,mobility_condition=="high") %>% pull(se.mean) %>% round(1)
  
  avg_mlow <- filter(summ_m,mobility_condition=="low") %>% pull(mean) %>% round(1)
  se_mlow <-  filter(summ_m,mobility_condition=="low") %>% pull(se.mean) %>% round(1)
  
  
  highm_string <- paste0("High mobility\n(m=",avg_mhigh,", se=",se_mhigh,")")
  lowm_string <- paste0("Low mobility\n(m=",avg_mlow,", se=",se_mlow,")")
  
  dd <- left_join(d,summ,by=c("empathy_condition","mobility_condition")) %>%
    mutate(mobility_condition=factor(mobility_condition, levels = c("low","high"),
                                    labels = c(lowm_string, highm_string)))
  
  # https://github.com/tidyverse/ggplot2/wiki/labeller "#EBCC2A" yellow
  ggplot(dd, aes(empathy_condition, y)) + 
    geom_jitter(size = 0.25, width = .1, alpha=0.4) + 
    stat_summary(fun=mean, geom="point",color="darkred", shape ="square", size = 1.5) +
    geom_errorbar(aes(ymin=mean.value-se.mean,ymax=mean.value+se.mean), width=.075, color = "darkred") +
    facet_wrap(~ mobility_condition) +
    labs(subtitle = ifelse(is.na(subtitle), get_qtext(dependent_var), subtitle),
         x =xlab, y = ylab, caption = caption, color = "Party") + 
    theme(plot.subtitle = element_textbox_simple()) + 
    theme(text = element_text(size = 8))  + 
    geom_text(aes(x=empathy_condition,y=-3, label=paste0("m=",round(mean.value,1))), size=2, fontface="plain")
  
}
se_caption <- paste0("Note: The plot shows the means in the four groups and the associated standard error of the mean.")
```


## General welfare preferences

```{r plot-general-welfare, fig.cap="General welfare preferences"}
ggarrange(plot_dv("dv_gen_welfare_1",ylab = "",xlab = "") + 
               theme(plot.subtitle = element_textbox_simple()),
             plot_dv("dv_gen_welfare_2",ylab = "",xlab = "")+ 
               theme(plot.subtitle = element_textbox_simple()), labels = "auto", nrow = 1) %>%  
  annotate_figure(bottom = text_grob("Empathy Condition", size=10),left = text_grob("Agreement",size=10, rot = 90))
```


__Figure \@ref(fig:plot-general-welfare)a__

- HM: Ps in the HM condition are _more_ likely support welfare programs to ensure fairness.
  - If the US provides good opportunities, Ps may think that (existing) welfare policies are effective in ensuring fairness.
- HM-ET: If they are also exposed to homelessness, they don't endorse welfare programs by the government.
  - Seeing homelessness casts doubt on the effectiveness of welfare programs.
- LM: Ps in the LM condition are _less_ likely support welfare programs.
  - If those opportunities are not available, they think that welfare programs are ineffective. 
- HM-ET: If they are exposed to homelessness, they are more likely to endorse programs by the government.
  - Seeing homelessness in addition to sparse opportunities leads Ps to belief that the government should at least try welfare programs.
  
The American does not reduce but increase a more comprehensive welfare by strenghtening the belief in the efficacy of government. Ideology ftw!

__Figure \@ref(fig:plot-general-welfare)b__

- HM: If there are good opportunities, Ps don't think that the government spends too much on welfare. 
  - They might attribute good opportunities to welfare spending.
- HM-ET: Yet if Ps are also exposed to homelessness, they are more likely to think that the government spends too much.
  - Despite providing good opportunities, they see that the system leaves groups behind, thus showing the inefficacy of welfare spending.
- LM: If there are few opportunities, Ps think the government spends too much on welfare.
  - They attribute bad opportunities to the inefficacy of welfare spending.
- HM-ET: If Ps are also exposed to homelessness, they are less likely to think that the government spends too much. 
  - The U.S. offers few opportunities and it leaves people behind, but the government should do at least something.

## Specific welfare preference

```{r plot-specific-welfare, fig.cap="Specific welfare preferences: Food stamps and food banks"}
ggarrange(plot_dv("dv_spec_welfare_pol_1",ylab = "",xlab = ""), 
          plot_dv("dv_spec_welfare_pol_2",ylab = "",xlab = ""), labels = "auto",nrow=1) %>%  
  annotate_figure(top = text_grob("Please rate how much you agree or disagree that the government should", size=9, hjust = .7),
                  bottom = text_grob("Empathy Condition", size=10),
                  left = text_grob("Agreement",size=10, rot = 90))
```


__Figure \@ref(fig:plot-specific-welfare)a__

- HM: Ps in the HM condition are _more_ likely to endorse expanding access to food stamps.
- HM-ET: If Ps are also exposed to homelessness, they are _less_ likely to hold that view.
- LM: Ps in the LM condition are _less_ likely to endorse expanding access to food stamps.
- LM-ET: If Ps are also exposed to homelessness, they are _more_ likely to hold that view.

__Figure \@ref(fig:plot-specific-welfare)b__

See pattern as for figure \@ref(fig:plot-specific-welfare)a.

```{r plot-specific-welfare-preferences-insurance, fig.cap="Specific welfare preferences: Unemployment Insurnace and health care"}
ggarrange(plot_dv("dv_spec_welfare_pol_13",ylab = "",xlab = ""), 
          plot_dv("dv_spec_welfare_pol_14",ylab = "",xlab = "", subtitle = paste0(get_qtext("dv_spec_welfare_pol_14"),"     \n                 . \n")),
          nrow=1, labels = "auto",font.label = list(size=11)) %>%  
  annotate_figure(top = text_grob("Please rate how much you agree or disagree that the government should", size=9, hjust = .7),bottom = text_grob("Empathy Condition", size=10),
                  left = text_grob("Agreement",size=10, rot = 90))
```



## Support for the poor

```{r}
ggarrange(plot_dv("dv_welfare_poor_hard_1",ylab = "",xlab = ""), 
          plot_dv("dv_welfare_poor_hard_2",ylab = "",xlab = ""), 
          nrow=1, font.label = list(size=11),labels = "auto") %>%  
  annotate_figure(bottom = text_grob("Empathy Condition", size=10),
                  left = text_grob("Agreement",size=10, rot = 90))
```



## Support for hard-working people

```{r}
ggarrange(plot_dv("dv_welfare_poor_hard_13",ylab = "",xlab = ""), 
          plot_dv("dv_welfare_poor_hard_14",ylab = "",xlab = ""), 
          nrow=1, font.label = list(size=11),labels = "auto") %>%  
  annotate_figure(bottom = text_grob("Empathy Condition", size=10),
                  left = text_grob("Agreement",size=10, rot = 90))

```


## Social mobility policy 

```{r social-mobility-childhood-education, fig.cap="Social mobility policy: Childhood education"}
ggarrange(plot_dv("dv_mobility_pol_1",ylab = "",xlab = ""), 
          plot_dv("dv_mobility_pol_3",ylab = "",xlab = "", 
                  subtitle = paste0(get_qtext("dv_mobility_pol_3"),"                          \n .               \n ."))+
            theme(plot.subtitle = element_textbox_simple()), 
          nrow=1, font.label = list(size=11),labels = "auto") %>%  
  annotate_figure(bottom = text_grob("Empathy Condition", size=10),
                  left = text_grob("Agreement",size=10, rot = 90))
```



```{r social-mobility-college-education, fig.cap="Social mobility policy: College education"}
ggarrange(plot_dv("dv_mobility_pol_2",ylab = "",xlab = ""), 
          plot_dv("dv_mobility_pol_10",ylab = "",xlab = "", subtitle = paste0(get_qtext("dv_mobility_pol_10"),"                          \n .")),
          nrow=1, labels = "auto",font.label = list(size=11)) %>%  
  annotate_figure(bottom = text_grob("Empathy Condition", size=10),
                  left = text_grob("Agreement",size=10, rot = 90))
```

## Inequality

```{r}
plot_dv("dv_ineq_1")
```

## Empathetic concern

```{r}
report_tstat <- function(ttest){
  paste0("$t\\approx$ ", round(ttest$statistic, 2))
}

tt_ec1 <- t.test(empa_conc_1 ~ mobility_condition, df)
tt_ec2 <- t.test(empa_conc_2 ~ mobility_condition, df)
tt_ec3 <- t.test(empa_conc_3 ~ mobility_condition, df)
tt_ec4 <- t.test(empa_conc_4 ~ mobility_condition, df)


tt_ec1_HM <- t.test(empa_conc_1 ~ empathy_condition, filter(df,mobility_condition=="high"))
tt_ec2_HM <- t.test(empa_conc_2 ~ empathy_condition, filter(df,mobility_condition=="high"))
tt_ec3_HM <- t.test(empa_conc_3 ~ empathy_condition, filter(df,mobility_condition=="high"))
tt_ec4_HM <- t.test(empa_conc_4 ~ empathy_condition, filter(df,mobility_condition=="high"))

tt_ec1_LM <- t.test(empa_conc_1 ~ empathy_condition, filter(df,mobility_condition=="low"))
tt_ec2_LM <- t.test(empa_conc_2 ~ empathy_condition, filter(df,mobility_condition=="low"))
tt_ec3_LM <- t.test(empa_conc_3 ~ empathy_condition, filter(df,mobility_condition=="low"))
tt_ec4_LM <- t.test(empa_conc_4 ~ empathy_condition, filter(df,mobility_condition=="low"))

pvals <- lapply(list(tt_ec1_HM, tt_ec2_HM, tt_ec3_HM, tt_ec4_HM, tt_ec1_LM, tt_ec2_LM, tt_ec3_LM, tt_ec4_LM), function(tt) tt[["p.value"]]) 


```


There are no significant differences in empathetic concern between Ps in the HM and the LM condition. The p-values associated with the t-statistics for items in figures \@ref(fig:empathetic-concern-1)a,  \@ref(fig:empathetic-concern-1)b, \@ref(fig:empathetic-concern-2)a, and \@ref(fig:empathetic-concern-2)b are `r report_pval(tt_ec1$p.value)`, `r report_pval(tt_ec2$p.value)`, `r report_pval(tt_ec3$p.value)`, and `r report_pval(tt_ec4$p.value)` respectively. 

The videos on homelessness elicit empathy. `r sum(pvals < 0.05)` of the `r length(pvals)` t-tests to compare empathetic concern within either the high or the low mobility condition of the four items revealed a significant difference at the $\alpha=0.05$ level.

```{r empathetic-concern-1, fig.cap="Empathetic concern (1)"}
ggarrange(plot_dv("empa_conc_1",ylab = "",xlab = ""), 
          plot_dv("empa_conc_2",ylab = "",xlab = ""),
          nrow=1, labels = "auto",font.label = list(size=11)) %>%  
  annotate_figure(bottom = text_grob("Empathy Condition", size=10),
                  left = text_grob("Agreement",size=10, rot = 90))
```
```{r empathetic-concern-2, fig.cap="Empathetic concern (2)"}
ggarrange(plot_dv("empa_conc_3",ylab = "",xlab = ""), 
          plot_dv("empa_conc_4",ylab = "",xlab = ""),
          nrow=1, labels = "auto",font.label = list(size=11)) %>%  
  annotate_figure(bottom = text_grob("Empathy Condition", size=10),
                  left = text_grob("Agreement",size=10, rot = 90))
```


## Perspective taking

```{r perspective-taking-1, fig.cap="Perspective taking (1)"}
ggarrange(plot_dv("me_persp_tak_1",ylab = "",xlab = ""), 
          plot_dv("me_persp_tak_2",ylab = "",xlab = ""),
          nrow=1, labels = "auto",font.label = list(size=11)) %>%  
  annotate_figure(bottom = text_grob("Empathy Condition", size=10),
                  left = text_grob("Agreement",size=10, rot = 90))
```
```{r perspective-taking-2, fig.cap="Perspective taking (2)"}
plot_dv("me_persp_tak_3")
```


## Situational attribution of poverty

```{r}
ggarrange(plot_dv("me_situational_attr_1",ylab = "",xlab = ""), 
          plot_dv("me_situational_attr_2",ylab = "",xlab = ""),
          nrow=1, labels = "auto",font.label = list(size=11)) %>%  
  annotate_figure(bottom = text_grob("Empathy Condition", size=10),
                  left = text_grob("Importance",size=10, rot = 90))
```
```{r}
ggarrange(plot_dv("me_situational_attr_3",ylab = "",xlab = ""), 
          plot_dv("me_situational_attr_4",ylab = "",xlab = ""),
          nrow=1, labels = "auto",font.label = list(size=11)) %>%  
  annotate_figure(bottom = text_grob("Empathy Condition", size=10),
                  left = text_grob("Importance",size=10, rot = 90))
```



## Dipositional attribution of poverty

```{r dispositional-attribution-1, fig.cap="Dispositional attribution (1)"}
ggarrange(plot_dv("me_dispos_attr_5",ylab = "",xlab = ""), 
          plot_dv("me_dispos_attr_6",ylab = "",xlab = ""),
          nrow=1, labels = "auto",font.label = list(size=11)) %>%  
  annotate_figure(bottom = text_grob("Empathy Condition", size=10),
                  left = text_grob("Importance",size=10, rot = 90))
```
```{r dispositional-attribution-2, fig.cap="Dispositional attribution (2)"}
ggarrange(plot_dv("me_dispos_attr_7",ylab = "",xlab = ""), 
          plot_dv("me_dispos_attr_8",ylab = "",xlab = ""),
          nrow=1,labels = "auto", font.label = list(size=11)) %>%  
  annotate_figure(bottom = text_grob("Empathy Condition", size=10),
                  left = text_grob("Importance",size=10, rot = 90))
```


# Regression analysis

```{r dependent-variables}
dvs <- c("dv_gen_welfare_1","dv_gen_welfare_2",
  "dv_spec_welfare_pol_1","dv_spec_welfare_pol_2","dv_spec_welfare_pol_13","dv_spec_welfare_pol_14",
  "dv_welfare_poor_hard_1","dv_welfare_poor_hard_2","dv_welfare_poor_hard_13","dv_welfare_poor_hard_14",
  "dv_mobility_pol_1","dv_mobility_pol_3","dv_mobility_pol_2","dv_mobility_pol_10")
```


```{r estimate-models-with-two-conditions-and-interactions, fig.cap="Effect plot for the two conditions and their interaction"}
# simple models with just the two conditions and their interaction
sm_formulas <- lapply(paste0(dvs, "~ mobility_condition * empathy_condition"), formula) # create formulas for linear models
sm <- lapply(sm_formulas, function(f) lm(f, df))                                        # estimate models
names(sm) <- paste0("sm_", dvs)                                                         # set names of models in list

# create data frame with model statistics
sm_summs <- lapply(sm, function(m) broom::tidy(m, conf.int=T)) %>% do.call(rbind, .)
# create column with dv name 
sm_summs$dv <- lapply(names(sm), function(n) rep(n, length(coef(sm$sm_dv_gen_welfare_1)))) %>% unlist()
sm_summs <- sm_summs %>% 
  mutate(term = factor(term, levels = c("(Intercept)", "mobility_conditionlow", "empathy_conditiontreatment", "mobility_conditionlow:empathy_conditiontreatment"), 
                labels = c("(Intercept)", "Low mobility", "Homelessness", "Low mob. x Homelessness")), 
  dv = factor(dv, levels = names(sm)[length(sm):1]))
#there might be an issue with these models
# model_dashboard(sm$sm_dv_spec_welfare_pol_14)  
# model_dashboard(sm$sm_dv_welfare_poor_hard_13)
#model_dashboard(sm$sm_dv_welfare_poor_hard_14)
# model_dashboard(sm$sm_dv_mobility_pol_10)
sm_summs %>% 
  filter(term != "(Intercept)") %>% 
  ggplot(aes(estimate, dv, height=0, xmin=conf.low,xmax=conf.high)) +  
  geom_point() + 
  facet_wrap(~ term) +
  geom_vline(xintercept = 0, lty = 4) + 
  theme_bw() + 
  geom_errorbarh() + 
  labs(x = "Estimate with 95% confidence interval", y="Dependent variables") + 
  theme(text = element_text(size = 10))
  
```




# Moderator


The effect of the empathy condition (exposure to poverty vs control) on support for welfare policy was significantly stronger in the low mobility  on the mobility condition $B=  25.024, se=8.155, t(207)=3.068,p=0.002$. In the low mobility condition, participants in the exposure to poverty condition reported significantly higher support for welfare policy than participants in the control condition. ($B=13.792,se=5.755,t(207)=2.397,p=0.017$). In the high mobility condition, participants in the exposed to poverty condition reported marginally significantly lower support for welfare policy than participants in the control condition $(B=-11.231,se=5.778,t(207)=-1.944,p=0.053)$.


```{r}
mo <- lm(dv_gen_welfare_1 ~ empathy_condition * mobility_condition, df)
summary(mo)

df <- df %>% 
  mutate(mobility_condition = factor(mobility_condition, levels = c("low","high")))
mo <- lm(dv_gen_welfare_1 ~ empathy_condition * mobility_condition, df)
summary(mo)
```


```{r}
a <- df %>% 
  select(dv_gen_welfare_1, dv_gen_welfare_2, dv_spec_welfare_pol_1, dv_spec_welfare_pol_2,
         dv_spec_welfare_pol_13, dv_spec_welfare_pol_14) %>%
  psych::alpha()

df <- df %>%
  mutate(dv_gen_welfare_2 = 100 - dv_gen_welfare_2,
         dv_welfare = (dv_gen_welfare_1 + dv_gen_welfare_2) / 2)


te <- lm(dv_gen_welfare_1 ~ empathy_condition * mobility_condition, df)
s1 <- lm(me_situational_attr_1 ~ empathy_condition * mobility_condition, df)
s2 <- lm(dv_gen_welfare_1 ~ empathy_condition * mobility_condition + me_situational_attr_1, df)
summary(te)
summary(s1)
summary(s2)
```


```{r}

## Run Bootstrapping
set.seed(1)
.bootstrapping <- function(data, indices) {
  d <- data[indices, , drop = FALSE] # allows boot to select sample
  s1 <- lm(me_situational_attr_1 ~ empathy_condition * mobility_condition, data = d)
  s2 <- lm(dv_gen_welfare_1 ~ empathy_condition * mobility_condition + me_situational_attr_1, data = d)
  indirectEffect <- unname(coef(s1)[4])*unname(coef(s2)[4])
  return(indirectEffect)
}
bootstrap.summary <- boot::boot(data = df, statistic = .bootstrapping, R = 5000)
bootstrap.summary
bootstrap.ci1 <- boot::boot.ci(bootstrap.summary, type="bca", conf = 0.95, index = 1)
bootstrap.ci1
```

# Mediation


```{r}
te <- lm(dv_gen_welfare_1 ~ empathy_condition, df)
s1 <- lm(empa_conc_1 ~ empathy_condition, df)
s2 <- lm(dv_gen_welfare_1 ~ empathy_condition + empa_conc_1, df)

summary(te)
summary(s1)
summary(s2)
```




